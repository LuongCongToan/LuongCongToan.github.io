window.__require=function t(e,o,n){function c(i,a){if(!o[i]){if(!e[i]){var s=i.split("/");if(s=s[s.length-1],!e[s]){var l="function"==typeof __require&&__require;if(!a&&l)return l(s,!0);if(r)return r(s,!0);throw new Error("Cannot find module '"+i+"'")}i=s}var u=o[i]={exports:{}};e[i][0].call(u.exports,function(t){return c(e[i][1][t]||t)},u,u.exports,t,e,o,n)}return o[i].exports}for(var r="function"==typeof __require&&__require,i=0;i<n.length;i++)c(n[i]);return c}({"game-control":[function(t,e,o){"use strict";cc._RF.push(e,"e1b90/rohdEk4SdmmEZANaD","game-control");var n,c=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,n){var c,r=arguments.length,i=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(t,e,o,n);else for(var a=t.length-1;a>=0;a--)(c=t[a])&&(i=(r<3?c(i):r>3?c(e,o,i):c(e,o))||i);return r>3&&i&&Object.defineProperty(e,o,i),i};Object.defineProperty(o,"__esModule",{value:!0});var i=t("./game"),a=t("./input-control"),s=t("./mesh-triangle"),l=t("./mess-effect"),u=t("./utils"),p=cc._decorator,h=p.ccclass,f=p.property,d=(p.executeInEditMode,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.mesh_node=null,e.gameCamera=null,e.fMainRootScale=.18,e.RotateToTarget=function(){return cc.tween().to(.5,{rotation:e.target},{progress:function(t,o,n,c){var r=t.lerp(o,c);return e.node.setRotation(r),r}})},e.CreateTriangles=function(t){return cc.tween().call(function(){e.started=!1,o.factorRotZ=0}).delay(.01).call(function(){var t=u.default.Random(30,150)*(Math.random()<=.5?1:-1),o=u.default.Random(160,200)*(Math.random()<=.5?1:-1),n=u.default.Random(10,80)*(Math.random()<=.5?1:-1);cc.Quat.fromEuler(e.target,t,o,n);var c=cc.v3();cc.Vec3.random(c),c.mulSelf(360),cc.Quat.fromEuler(e.rotation,c.x,c.y,c.z),e.node.setRotation(e.rotation)}).delay(.05).call(function(){e.CreateTriangleMeshes(t),e.angleDistance=150})},e.rotateSpeed=45e3,e.smooth=.3,e.finishSmooth=.06,e.inertia=.05,e.started=!1,e.rotation=cc.quat(),e.target=cc.quat(),e.angleDiff=0,e.lastFrameQuaternion=cc.quat(),e.lastPos=cc.Vec3.ZERO,e.targetRotX=0,e.targetRotY=0,e._deltaX=0,e._deltaY=0,e._rotateZ=0,e.CanRotate=function(){var t=u.default.QuatIdentity();return!(Math.abs(e.rotation.x-t.x)<.02&&Math.abs(e.rotation.y-t.y)<.02&&e.angleDiff<.1)},e}var o;return c(e,t),o=e,e.prototype.onLoad=function(){o.instance=this},e.prototype.start=function(){this.node.setScale(this.fMainRootScale)},e.prototype.LoadNextTrack=function(t,e){var o=this;void 0===e&&(e=null),this.CreateTriangles(t).then(this.RotateToTarget().clone(this)).call(function(){o.started=!0,e&&e()}).clone(this).start()},e.prototype.FadeOut=function(){this.node.getComponentsInChildren(s.default).forEach(function(t){t.node.activeInHierarchy&&t.FadeOut()})},e.prototype.ClearTriangles=function(){for(;this.node.childrenCount>1;){var t=this.node.children[1];this.node.removeChild(t,!0)}this.started=!1,this.node.setRotation(u.default.QuatIdentity())},e.prototype.CreateTriangleMeshes=function(t){for(var e in t.json){var o=t.json[e],n=parseInt(o.amount),c=o.color.split(","),r=255*parseFloat(c[0]),i=255*parseFloat(c[1]),a=255*parseFloat(c[2]),s=cc.color(r,i,a);if(3==n){for(var l=[],u=1;u<=3;u++){var p=o.borders[u.toString()].split(",");l.push(cc.v2(parseFloat(p[0]),parseFloat(p[1])))}this.CreateTriangleMesh(l,s,e)}}},e.prototype.CreateTriangleMesh=function(t,e,o){var n=cc.v3(t[0]),c=cc.v3(t[1]),r=cc.v3(t[2]),i=n,a=c,u=r,p=i.add(a).add(u).div(3),h=this.fMainRootScale,f=this.RandomPoint(n,c,r);n=f[0],c=f[1],r=f[2];var d=n.add(c).add(r).div(3);n=n.sub(d).mul(h),c=c.sub(d).mul(h),r=r.sub(d).mul(h),i=i.sub(p).mul(h),a=a.sub(p).mul(h),u=u.sub(p).mul(h);var y=cc.instantiate(this.mesh_node);y.name="obj_"+o,y.parent=this.node,y.position=d,y.scale=5.5555;var m=y.getComponent(s.default),v=y.getComponent(l.default);this.IsClockWise(n,c,r)?(m.draw(r,c,n,e),v.SetOriginalVertices(u,a,i,p,e)):(m.draw(n,c,r,e),v.SetOriginalVertices(i,a,u,p,e)),y.active=!0},e.prototype.IsClockWise=function(t,e,o){return(e.x-t.x)*(o.y-e.y)-(e.y-t.y)*(o.x-e.x)>=0},e.prototype.CalcRatio=function(t){return(t*this.fMainRootScale+1e3)/1e3},e.prototype.RandomPoint=function(t,e,o){var n=u.default.Random(-400,300),c=n+u.default.Random(100),r=this.CalcRatio(c),i=t.mul(r).sub(cc.v3(0,0,c)),a=n+u.default.Random(100);r=this.CalcRatio(a);var s=e.mul(r).sub(cc.v3(0,0,a)),l=n+u.default.Random(100);return r=this.CalcRatio(l),[i,s,o.mul(r).sub(cc.v3(0,0,l))]},e.prototype.GetAngleDistance=function(){return this.angleDistance},e.prototype.GetAngleDistanceRatio=function(){return this.angleDistance/180},e.prototype.UpdateAngleDistance=function(){var t=cc.quat();cc.Quat.fromEuler(t,this.node.eulerAngles.x,this.node.eulerAngles.y,0);var e=u.default.QuatIdentity(),o=u.default.QuatAngle(e,t);o=cc.misc.clampf(o,0,180),this.angleDistance=Math.floor(180-o)},e.prototype.ProcessInput=function(t){if(1==a.default.instance.touchState)this.lastPos=a.default.instance.touchLocation,this.targetRotX=0,this.targetRotY=0;else if(2==a.default.instance.touchState){var e=a.default.instance.touchLocation.x-this.lastPos.x,n=a.default.instance.touchLocation.y-this.lastPos.y,c=e/cc.winSize.width*-this.rotateSpeed,r=n/cc.winSize.height*this.rotateSpeed;this._deltaX=u.default.Lerp(this._deltaX,c,.5,.01),this._deltaY=u.default.Lerp(this._deltaY,r,.5,.01),this._rotateZ=cc.misc.clampf(.2*(this._deltaX+this._deltaY),-90,90),o.factorRotZ=u.default.Lerp(o.factorRotZ,this._rotateZ,t,.1),this.targetRotX=cc.misc.lerp(this.targetRotX,this._deltaX,this.smooth)*t,this.targetRotY=cc.misc.lerp(this.targetRotY,this._deltaY,this.smooth)*t,this.RotateAroundAxis(cc.v3(1,0,0),this.targetRotY),this.RotateAroundAxis(cc.v3(0,1,0),this.targetRotX),this.lastPos=a.default.instance.touchLocation}else 0==a.default.instance.touchState&&(this._deltaX=u.default.Lerp(this._deltaX,0,.4,.01),this._deltaY=u.default.Lerp(this._deltaY,0,.4,.01),this.targetRotX=cc.misc.lerp(this.targetRotX,0,this.inertia),this.targetRotY=cc.misc.lerp(this.targetRotY,0,this.inertia),this.RotateAroundAxis(cc.v3(1,0,0),this.targetRotY),this.RotateAroundAxis(cc.v3(0,1,0),this.targetRotX))},e.prototype.RotateAroundAxis=function(t,e){var o=cc.quat();cc.Quat.fromAxisAngle(o,t,cc.misc.degreesToRadians(e));var n=u.default.GetRotation(this.node);cc.Quat.multiply(this.rotation,o,n),this.node.setRotation(this.rotation)},e.prototype.update=function(t){if(this.started){if(this.CanRotate())this.ProcessInput(t);else{var e=u.default.QuatIdentity();cc.Quat.slerp(this.rotation,this.rotation,e,this.finishSmooth),this.node.setRotation(this.rotation),u.default.QuatAngle(e,this.rotation)<1&&(cc.Quat.slerp(this.rotation,this.rotation,e,3*this.finishSmooth),this.started=!1,this.node.setRotation(e),i.default.instance.ShowResult())}this.UpdateAngleDistance(),this.angleDiff=u.default.QuatAngle(this.rotation,this.lastFrameQuaternion),this.lastFrameQuaternion=this.rotation}},e.prototype.PlayCompleteEffect=function(){this.node.getComponentsInChildren(l.default).forEach(function(t){t.node.activeInHierarchy&&t.DoEffect()})},e.prototype.GetFactorRotZ=function(){return this.node.eulerAngles.z+3.6*o.factorRotZ*(1-this.GetAngleDistanceRatio())},e.factorRotZ=0,r([f(cc.Node)],e.prototype,"mesh_node",void 0),r([f(cc.Camera)],e.prototype,"gameCamera",void 0),r([f()],e.prototype,"fMainRootScale",void 0),r([f()],e.prototype,"rotateSpeed",void 0),r([f()],e.prototype,"smooth",void 0),r([f()],e.prototype,"finishSmooth",void 0),r([f()],e.prototype,"inertia",void 0),o=r([h],e)}(cc.Component));o.default=d,cc._RF.pop()},{"./game":"game","./input-control":"input-control","./mesh-triangle":"mesh-triangle","./mess-effect":"mess-effect","./utils":"utils"}],game:[function(t,e,o){"use strict";cc._RF.push(e,"093cdMVhGZIGpsoRlvT3Gaa","game");var n,c=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,n){var c,r=arguments.length,i=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(t,e,o,n);else for(var a=t.length-1;a>=0;a--)(c=t[a])&&(i=(r<3?c(i):r>3?c(e,o,i):c(e,o))||i);return r>3&&i&&Object.defineProperty(e,o,i),i};Object.defineProperty(o,"__esModule",{value:!0}),o.GameState=void 0;var i,a=t("./game-control"),s=t("./icon-holder"),l=t("./sound-manager"),u=cc._decorator,p=u.ccclass,h=u.property;(function(t){t[t.Prepared=0]="Prepared",t[t.Started=1]="Started",t[t.CompleteTrack=2]="CompleteTrack",t[t.Paused=3]="Paused",t[t.Finished=4]="Finished"})(i=o.GameState||(o.GameState={}));var f=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.gameControl=null,e.amazingNode=null,e.gameState=i.Prepared,e._initializedStep={Audio:!1,JsonData:!1},e.amazingStr=["Amazing","Wonderful","Marvellous"],e.polydata={},e.onSoundLoaded=function(){l.default.instance.SetAllMusicVolume(0),e._initializedStep.Audio=!0},e}var o;return c(e,t),o=e,e.prototype.onLoad=function(){var t=this;o.instance=this,cc.resources.loadDir("polyjson",cc.JsonAsset,function(e,o){o.forEach(function(e){t.polydata[e.name]=e}),t._initializedStep.JsonData=!0})},e.prototype.update=function(){if(this.gameState==i.Prepared){var t=!0;for(var e in this._initializedStep)if(0==this._initializedStep[e]){t=!1;break}t&&this.InitGame()}},e.prototype.InitGame=function(){this.gameControl.LoadNextTrack(this.polydata["1_gem"]),l.default.instance.PlayAllMusic(!0),l.default.instance.SetMusicVolume(0,0,1,!0),this.gameState=i.Started},e.prototype.ShowResult=function(){console.log("TODO -> firework particle !"),this.PlayEffect()},e.prototype.OnTrackCompleted=function(){switch(this.gameState=i.CompleteTrack,o.currentTrack){case 0:l.default.instance.SetVolume(1,1,!0);break;case 1:l.default.instance.SetVolume(2,1,!0);break;case 2:l.default.instance.SetVolume(0,0,!0),l.default.instance.SetVolume(1,0,!0),l.default.instance.SetVolume(2,0,!0),l.default.instance.SetVolume(3,1,!0)}},e.prototype.PlayEffect=function(){var t=this;cc.tween(this).call(function(){t.amazingNode.getComponent(cc.RichText).string=t.amazingStr[o.currentTrack],t.amazingNode.getComponent(cc.Animation).play("Amazing"),t.OnTrackCompleted()}).delay(.5).call(function(){t.gameControl.PlayCompleteEffect(),console.log("PlayEffect -> TODO Play Particle effFinishedRing "),console.log("PlayEffect -> TODO Play Particle effFinishedParticles ")}).delay(2.2).then(cc.tween(this).call(function(){t.gameControl.FadeOut()})).then(cc.tween(this).call(function(){s.default.instance.Play_Alpha(),t.gameControl.ClearTriangles()})).delay(.1).then(cc.tween(this).call(function(){s.default.instance.Play_FlyAndScale()})).delay(1.5).call(this.NextTrack.bind(this)).start()},e.prototype.NextTrack=function(){var t=this;o.currentTrack+=1;var e=1==o.currentTrack?this.polydata["2_butterfly"]:this.polydata["3_guitar"];o.currentTrack<3?this.gameControl.LoadNextTrack(e,function(){t.gameState=i.Started}):this.OnPlayerFinish()},e.prototype.OnPlayerFinish=function(){console.log("TODO -> link to store")},e.currentTrack=0,r([h(a.default)],e.prototype,"gameControl",void 0),r([h(cc.Node)],e.prototype,"amazingNode",void 0),o=r([p],e)}(cc.Component);o.default=f,cc._RF.pop()},{"./game-control":"game-control","./icon-holder":"icon-holder","./sound-manager":"sound-manager"}],"icon-holder":[function(t,e,o){"use strict";cc._RF.push(e,"40ea8dDljZMub9n8W9Kw8J3","icon-holder");var n,c=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,n){var c,r=arguments.length,i=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(t,e,o,n);else for(var a=t.length-1;a>=0;a--)(c=t[a])&&(i=(r<3?c(i):r>3?c(e,o,i):c(e,o))||i);return r>3&&i&&Object.defineProperty(e,o,i),i};Object.defineProperty(o,"__esModule",{value:!0});var i=t("./game"),a=t("./icon-track"),s=cc._decorator,l=s.ccclass,u=s.property,p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.iconTracks=[],e}var o;return c(e,t),o=e,e.prototype.onLoad=function(){o.instance=this},e.prototype.Play_FlyAndScale=function(){this.iconTracks[i.default.currentTrack].Play_FlyAndScale()},e.prototype.Play_Alpha=function(){this.iconTracks[i.default.currentTrack].iconImage.active=!0,cc.tween(this.iconTracks[i.default.currentTrack].iconImage).call(function(){return console.log("Play_Alpha Start --\x3e")}).to(.1,{opacity:255}).call(function(){return console.log("Play_Alpha End --\x3e")}).start()},r([u({type:a.default})],e.prototype,"iconTracks",void 0),o=r([l],e)}(cc.Component);o.default=p,cc._RF.pop()},{"./game":"game","./icon-track":"icon-track"}],"icon-track":[function(t,e,o){"use strict";cc._RF.push(e,"648d123se1Adb+3iH0xPL8d","icon-track");var n,c=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,n){var c,r=arguments.length,i=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(t,e,o,n);else for(var a=t.length-1;a>=0;a--)(c=t[a])&&(i=(r<3?c(i):r>3?c(e,o,i):c(e,o))||i);return r>3&&i&&Object.defineProperty(e,o,i),i};Object.defineProperty(o,"__esModule",{value:!0});var i=cc._decorator,a=i.ccclass,s=i.property,l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.iconImage=null,e.coverCircle=null,e.coverWhite=null,e.twIcon=null,e.twCirle=null,e.twWhite=null,e}return c(e,t),e.prototype.onLoad=function(){var t=this;this.twIcon=cc.tween().parallel(cc.tween(this.iconImage).to(1,{position:cc.v3(0,0,0)},{progress:function(t,e,o,n){return t.mul(1-n).add(e.mul(n))}}),cc.tween(this.iconImage).to(.5,{scale:.25},{progress:function(t,e,o,n){return t*(1-n)+e*n}})).delay(.8).call(function(){return console.log("spectrum --\x3e TODO")}).delay(.5).call(function(){t.iconImage.active=!1}),this.twWhite=cc.tween().delay(1.4).to(.4,{opacity:255}).to(.4,{opacity:0}),this.twCirle=cc.tween().delay(2).to(.4,{opacity:255}).then(cc.tween(this.coverCircle).by(5,{angle:-360}).repeatForever())},e.prototype.Play_FlyAndScale=function(){this.twIcon.clone(this.iconImage).start(),this.twWhite.clone(this.coverWhite).start(),this.twCirle.clone(this.coverCircle).start()},r([s(cc.Node)],e.prototype,"iconImage",void 0),r([s(cc.Node)],e.prototype,"coverCircle",void 0),r([s(cc.Node)],e.prototype,"coverWhite",void 0),r([a],e)}(cc.Component);o.default=l,cc._RF.pop()},{}],"input-control":[function(t,e,o){"use strict";cc._RF.push(e,"b5cc3sIV5hGELkUkYPUyqHH","input-control");var n,c=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,n){var c,r=arguments.length,i=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(t,e,o,n);else for(var a=t.length-1;a>=0;a--)(c=t[a])&&(i=(r<3?c(i):r>3?c(e,o,i):c(e,o))||i);return r>3&&i&&Object.defineProperty(e,o,i),i};Object.defineProperty(o,"__esModule",{value:!0});var i=cc._decorator,a=i.ccclass,s=i.property,l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.canvas=null,e.touchState=0,e.touchLocation=cc.Vec3.ZERO,e}var o;return c(e,t),o=e,e.prototype.onLoad=function(){o.instance=this,console.log(""+cc.winSize)},e.prototype.start=function(){this.canvas.node.on(cc.Node.EventType.TOUCH_START,this.onTouchStart,this),this.canvas.node.on(cc.Node.EventType.TOUCH_MOVE,this.onTouchMove,this),this.canvas.node.on(cc.Node.EventType.TOUCH_END,this.onTouchEnd,this),this.canvas.node.on(cc.Node.EventType.TOUCH_CANCEL,this.onTouchEnd,this)},e.prototype.onTouchStart=function(t){this.touchLocation=this.CorrectTouchPoint(t.getLocation()),this.touchState=1},e.prototype.onTouchMove=function(t){this.touchLocation=this.CorrectTouchPoint(t.getLocation()),this.touchState=2},e.prototype.onTouchEnd=function(){this.touchState=0},e.prototype.CorrectTouchPoint=function(t){return cc.v3(t.x-cc.winSize.width/2,t.y-cc.winSize.height/2,0)},r([s(cc.Canvas)],e.prototype,"canvas",void 0),o=r([a],e)}(cc.Component);o.default=l,cc._RF.pop()},{}],"mesh-triangle":[function(t,e,o){"use strict";cc._RF.push(e,"56cfaLszqpAsbeOtlF9/UF8","mesh-triangle");var n,c=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,n){var c,r=arguments.length,i=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(t,e,o,n);else for(var a=t.length-1;a>=0;a--)(c=t[a])&&(i=(r<3?c(i):r>3?c(e,o,i):c(e,o))||i);return r>3&&i&&Object.defineProperty(e,o,i),i};Object.defineProperty(o,"__esModule",{value:!0});var i=t("./game-control"),a=t("./utils"),s=cc._decorator,l=s.ccclass,u=s.property,p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.gameControl=null,e.renderer=null,e.cameraNode=null,e.bEffect=!1,e.bClose=!1,e.bFirstShow=!0,e.effectTime=0,e.step=0,e.setMeshColor=function(t){e.renderer.mesh.setVertices(cc.gfx.ATTR_COLOR,[t,t,t])},e.DOAlpha=function(t){return cc.tween().to(.1,{opacity:t},{progress:function(t,e,o,n){return cc.misc.lerp(t,e,n)}})},e}return c(e,t),e.prototype.start=function(){this.DOAlpha(255).clone(this.node).start()},e.prototype.FadeOut=function(){this.DOAlpha(0).clone(this.node).start()},e.prototype.update=function(t){var e=this.gameControl.GetFactorRotZ(),o=cc.quat();cc.Quat.fromEuler(o,0,0,e),this.node.setRotation(o),this.effectTime>0&&(this.effectTime-=t),this.effectTime<=0&&!this.bClose&&this.closeEffect()},e.prototype.updateColor=function(t){if(this.step!=t){this.step=t;var e=.2+.8*this.step/150,o=cc.color();cc.Color.scale(o,this.color,e),this.setMeshColor(o)}},e.prototype.closeEffect=function(){this.bClose=!0,this.setMeshColor(this.color),this.node.opacity=this.color.a},e.prototype.draw=function(t,e,o,n){var c=cc.gfx,r=new c.VertexFormat([{name:c.ATTR_POSITION,type:c.ATTR_TYPE_FLOAT32,num:3},{name:c.ATTR_COLOR,type:c.ATTR_TYPE_UINT8,num:4,normalize:!0}]),i=new cc.Mesh;i.init(r,3,!0),i.setVertices(c.ATTR_POSITION,[t,e,o]),i.setVertices(c.ATTR_COLOR,[n,n,n]),i.setIndices([0,1,2]),this.color=n,this.renderer.mesh=i},e.prototype.doEffect=function(){this.bFirstShow?(a.default.Random()<=.5&&(this.bEffect=!0,this.bClose=!1,this.doEffect2()),this.bFirstShow=!1):(this.bEffect=!0,this.bClose=!1,this.doEffect2())},e.prototype.doEffect2=function(){var t=cc.color();cc.Color.scale(t,this.color,.8);var e=cc.color();cc.Color.scale(e,cc.Color.WHITE,.2),cc.Color.add(t,t,e),this.setMeshColor(t),this.effectTime=.1},r([u(i.default)],e.prototype,"gameControl",void 0),r([u(cc.MeshRenderer)],e.prototype,"renderer",void 0),r([u(cc.Node)],e.prototype,"cameraNode",void 0),r([l],e)}(cc.Component);o.default=p,cc._RF.pop()},{"./game-control":"game-control","./utils":"utils"}],"mess-effect":[function(t,e,o){"use strict";cc._RF.push(e,"26feeUd5kRFPLpyK+jdGp6v","mess-effect");var n,c=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,n){var c,r=arguments.length,i=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(t,e,o,n);else for(var a=t.length-1;a>=0;a--)(c=t[a])&&(i=(r<3?c(i):r>3?c(e,o,i):c(e,o))||i);return r>3&&i&&Object.defineProperty(e,o,i),i};Object.defineProperty(o,"__esModule",{value:!0});var i=t("./mesh-triangle"),a=cc._decorator,s=a.ccclass,l=a.property,u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.mesh=null,e.a=cc.v3(),e.b=cc.v3(),e.c=cc.v3(),e.center=cc.v3(),e.color=cc.color(255,255,255,50),e.DOPosition=function(t,e){return cc.tween().to(e,{position:t},{easing:"quadIn"})},e.DOScale=function(t,e){return cc.tween().to(e,{scale:t},{easing:"quadIn"})},e.DOColor=function(t,o){return cc.tween().to(o,{color:t},{progress:function(t,o,n,c){var r=t.lerp(o,c);return e.mesh.setMeshColor(r),r}})},e}return c(e,t),e.prototype.SetOriginalVertices=function(t,e,o,n,c){this.a=t,this.b=e,this.c=o,this.center=n,this.color=c},e.prototype.DoEffect=function(){this.node.position=this.center,this.mesh.draw(this.a,this.b,this.c,this.color);var t=this.node.position,e=this.node.scale,o=this.color,n=cc.color(255,255,255,201),c=t.mag(),r=t.normalize(),i=.001*c;r.z=0;var a=t.add(r.mul(.74*c)),s=1.36*e;cc.tween(this.node).delay(.5-i).parallel(this.DOPosition(a,.25).clone(this.node),this.DOScale(s,.25).clone(this.node),this.DOColor(n,.15).delay(.1).clone(this)).delay(.55).parallel(this.DOPosition(t,.5).clone(this.node),this.DOScale(e,.5).clone(this.node)).delay(.25).then(this.DOColor(o,.2).clone(this)).start()},r([l(i.default)],e.prototype,"mesh",void 0),r([s],e)}(cc.Component);o.default=u,cc._RF.pop()},{"./mesh-triangle":"mesh-triangle"}],"sound-manager":[function(t,e,o){"use strict";cc._RF.push(e,"ecfd13OKA9AQp4FwrtS/coD","sound-manager");var n,c=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,n){var c,r=arguments.length,i=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(t,e,o,n);else for(var a=t.length-1;a>=0;a--)(c=t[a])&&(i=(r<3?c(i):r>3?c(e,o,i):c(e,o))||i);return r>3&&i&&Object.defineProperty(e,o,i),i};Object.defineProperty(o,"__esModule",{value:!0});var i=t("./game"),a=cc._decorator,s=a.ccclass,l=a.property,u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.fadingTime=.5,e.audioSources={},e.audioVolumes={},e}var o;return c(e,t),o=e,e.prototype.onLoad=function(){var t=this;o.instance=this,cc.resources.loadDir("sound",cc.AudioClip,function(e,o){o.forEach(function(e){var o=t.node.addComponent(cc.AudioSource);o.clip=e,o.preload=!0,o.volume=0,t.audioSources[e.name]=o,t.audioVolumes[e.name]={},t.audioVolumes[e.name].main=1,t.audioVolumes[e.name].sub=1}),i.default.instance.onSoundLoaded()})},e.prototype.update=function(){for(var t in this.audioSources){var e=this.audioSources[t];if(e.isPlaying){var o=e.clip.duration-e.getCurrentTime();this.audioVolumes[t].sub=o<1.1*this.fadingTime?0:1;var n=this.audioVolumes[t].main*this.audioVolumes[t].sub;if(e.volume!=n){var c=1/(60*this.fadingTime),r=n-e.volume,i=r/Math.abs(r);e.volume=cc.misc.clamp01(e.volume+c*i)}}}},e.prototype.PlayAllMusic=function(t){for(var e in void 0===t&&(t=!1),this.audioSources)this.audioSources[e].loop=t,this.audioSources[e].play()},e.prototype.StopAllMusics=function(t){for(var e in void 0===t&&(t=0),this.audioSources)this.StopChannel(e,t)},e.prototype.StopChannel=function(t,e){var o=this;void 0===e&&(e=0),e>0?cc.tween(this.audioVolumes[t]).to(e,{main:0}).call(function(){o.audioSources[t].stop()}).start():(this.audioVolumes[t].main=0,this.audioSources[t].stop())},e.prototype.SetVolume=function(t,e,o){void 0===o&&(o=!1);var n=(t+1).toString();this.SetChannelVolumn(n,e,o)},e.prototype.SetAllMusicVolume=function(t,e){void 0===e&&(e=!1),this.SetMusicVolume(0,3,t,e)},e.prototype.SetMusicVolume=function(t,e,o,n){void 0===n&&(n=!1);for(var c=t;c<=e;c++){var r=(1+c).toString();this.audioVolumes[r].main!=o&&this.SetChannelVolumn(r,o,n)}},e.prototype.SetChannelVolumn=function(t,e,o){o?cc.tween(this.audioVolumes[t]).to(this.fadingTime,{main:e}).start():this.audioVolumes[t].main=e},r([l()],e.prototype,"fadingTime",void 0),o=r([s],e)}(cc.Component);o.default=u,cc._RF.pop()},{"./game":"game"}],utils:[function(t,e,o){"use strict";cc._RF.push(e,"4e3d0mhUGNOpZCA1HS+jtc2","utils"),Object.defineProperty(o,"__esModule",{value:!0});var n=function(){function t(){}return t.Random=function(t,e){return void 0===t&&(t=1),void 0===e&&(e=0),0==e?Math.random()*t:Math.random()*(e-t)+t},t.Lerp=function(t,e,o,n){if(0==o)return t;if(t==e)return e;var c=(e-t)*o,r=Math.abs(c),i=Math.abs(n);return r<i&&(c=i*c/r),(t-e)*(t+c-e)<0&&(c=e-t),t+c},t.QuatAngle=function(t,e){var o=cc.Quat.dot(t,e);return 114.59156*Math.acos(Math.min(Math.abs(o),1))},t.QuatIdentity=function(){var t=cc.quat();return cc.Quat.identity(t),t},t.GetRotation=function(t){var e=cc.quat();return t.getRotation(e),e},t.RotateAround=function(e,o,n){var c=t.GetRotation(e);cc.Quat.rotateAround(c,c,o,cc.misc.degreesToRadians(n)),e.setRotation(c)},t}();o.default=n,cc._RF.pop()},{}]},{},["game-control","game","icon-holder","icon-track","input-control","mesh-triangle","mess-effect","sound-manager","utils"]);